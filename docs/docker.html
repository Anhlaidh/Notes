<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="built-on" content="2024-04-30T19:18:20.823218"><title>Table of Contents | Notes</title><script type="application/json" id="virtual-toc-data">[{"id":"docker","level":0,"title":"Docker","anchor":"#docker"},{"id":"i7ehp9o_1224","level":0,"title":"概念\u0026安装","anchor":"#i7ehp9o_1224"},{"id":"i7ehp9o_1273","level":0,"title":"常用命令","anchor":"#i7ehp9o_1273"},{"id":"i7ehp9o_1420","level":0,"title":"镜像原理","anchor":"#i7ehp9o_1420"},{"id":"docker","level":0,"title":"Docker容器数据卷","anchor":"#docker"},{"id":"notes-tool-dockerfile","level":0,"title":"notes.Tool.DockerFile","anchor":"#notes-tool-dockerfile"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b259/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Table of Contents | Notes"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Notes Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/notes/0.1/docker.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Table of Contents | Notes"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/notes/0.1/docker.html#webpage",
    "url": "writerside-documentation/notes/0.1/docker.html",
    "name": "Table of Contents | Notes",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentationnotes/#website",
    "url": "writerside-documentationnotes/",
    "name": "Notes Help"
}</script><!-- End Schema.org --></head><body data-id="Docker" data-main-title="Table of Contents" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="README.md|Notes///java///notes///Tool"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Notes 0.1 Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Docker" id="Docker.md">Table of Contents</h1><ul class="list _bullet" id="i7ehp9o_1169"><li class="list__item" id="i7ehp9o_1170"><p><span id="i7ehp9o_1171">Docker</span></p></li><li class="list__item" id="i7ehp9o_1172"><p><span id="i7ehp9o_1173">Docker</span></p><ul class="list _bullet" id="i7ehp9o_1174"><li class="list__item" id="i7ehp9o_1175"><p><span id="i7ehp9o_1176">概念&amp;安装</span></p><ul class="list _bullet" id="i7ehp9o_1177"><li class="list__item" id="i7ehp9o_1178"><p><span id="i7ehp9o_1179">改源</span></p></li><li class="list__item" id="i7ehp9o_1180"><p><span id="i7ehp9o_1181">优缺点</span></p></li></ul></li><li class="list__item" id="i7ehp9o_1182"><p><span id="i7ehp9o_1183">常用命令</span></p><ul class="list _bullet" id="i7ehp9o_1184"><li class="list__item" id="i7ehp9o_1185"><p><span id="i7ehp9o_1186">帮助命令</span></p></li><li class="list__item" id="i7ehp9o_1187"><p><span id="i7ehp9o_1188">镜像命令</span></p></li><li class="list__item" id="i7ehp9o_1189"><p><span id="i7ehp9o_1190">容器命令</span></p><ul class="list _bullet" id="i7ehp9o_1191"><li class="list__item" id="i7ehp9o_1192"><p><span id="i7ehp9o_1193">新建并启动容器</span></p></li><li class="list__item" id="i7ehp9o_1194"><p><span id="i7ehp9o_1195">列出当前所有正住运行的容器</span></p></li><li class="list__item" id="i7ehp9o_1196"><p><span id="i7ehp9o_1197">操作容器</span></p></li></ul></li><li class="list__item" id="i7ehp9o_1198"><p><span id="i7ehp9o_1199">重要命令</span></p></li></ul></li><li class="list__item" id="i7ehp9o_1200"><p><span id="i7ehp9o_1201">镜像原理</span></p></li><li class="list__item" id="i7ehp9o_1202"><p><span id="i7ehp9o_1203">Docker容器数据卷</span></p></li><li class="list__item" id="i7ehp9o_1204"><p><span id="i7ehp9o_1205">notes.Tool.DockerFile</span></p><ul class="list _bullet" id="i7ehp9o_1206"><li class="list__item" id="i7ehp9o_1207"><p><span id="i7ehp9o_1208">直接命令添加</span></p></li><li class="list__item" id="i7ehp9o_1209"><p><span id="i7ehp9o_1210">DockerFile添加</span></p></li><li class="list__item" id="i7ehp9o_1211"><p><span id="i7ehp9o_1212">数据卷容器</span></p></li><li class="list__item" id="i7ehp9o_1213"><p><span id="i7ehp9o_1214">notes.Tool.DockerFile 规范</span></p></li><li class="list__item" id="i7ehp9o_1215"><p><span id="i7ehp9o_1216">DockerFile体系结构(保留字指令)</span></p><ul class="list _bullet" id="i7ehp9o_1217"><li class="list__item" id="i7ehp9o_1218"><p><span id="i7ehp9o_1219">遇到的问题</span></p></li></ul></li><li class="list__item" id="i7ehp9o_1220"><p><span id="i7ehp9o_1221">push</span></p></li></ul></li></ul></li></ul><section class="chapter"><h2 id="docker" data-toc="docker">Docker</h2><ul class="list _bullet" id="i7ehp9o_1222"><li class="list__item" id="i7ehp9o_1223"><p>CentOS6.5及以上</p></li></ul></section><section class="chapter"><h2 id="i7ehp9o_1224" data-toc="i7ehp9o_1224">概念&amp;安装</h2><ul class="list _bullet" id="i7ehp9o_1225"><li class="list__item" id="i7ehp9o_1226"><p id="i7ehp9o_1227">镜像 一个只读的模板,创建Docker容器</p></li><li class="list__item" id="i7ehp9o_1228"><p id="i7ehp9o_1229">容器 利用镜像创建的实例</p></li><li class="list__item" id="i7ehp9o_1230"><p id="i7ehp9o_1231">仓库 集中存放镜像文件的场所</p></li><li class="list__item" id="i7ehp9o_1232"><p id="i7ehp9o_1233">一般下载</p></li></ul><div class="code-block" data-lang="bash">
$ sudo yum install -y yum-utils

$ sudo yum-config-manager \
    --add-repo \
    https://download.docker.com/linux/centos/docker-ce.repo
</div><div class="code-block" data-lang="bash">
$ sudo yum-config-manager --enable docker-ce-nightly
</div><div class="code-block" data-lang="bash">
$ sudo yum-config-manager --enable docker-ce-test

</div><div class="code-block" data-lang="bash">
$ sudo yum-config-manager --disable docker-ce-nightly
</div><div class="code-block" data-lang="bash">
$ sudo yum install docker-ce docker-ce-cli containerd.io
</div><ul class="list _bullet" id="i7ehp9o_1239"><li class="list__item" id="i7ehp9o_1240"><p>启动</p></li></ul><div class="code-block" data-lang="bash">
$ sudo systemctl start docker
</div><ul class="list _bullet" id="i7ehp9o_1242"><li class="list__item" id="i7ehp9o_1243"><p>HelloWorld</p></li></ul><div class="code-block" data-lang="bash">
$ sudo docker run hello-world
</div><section class="chapter"><h3 id="i7ehp9o_1245" data-toc="i7ehp9o_1245">改源</h3><div class="code-block" data-lang="bash">
sudo mkdir -p /etc/docker
sudo tee /etc/docker/daemon.json &lt;&lt;-'EOF'
{
  &quot;registry-mirrors&quot;: [&quot;https://xxxxxxx.mirror.aliyuncs.com&quot;]
}
EOF
sudo systemctl daemon-reload
sudo systemctl restart docker

</div></section><section class="chapter"><h3 id="i7ehp9o_1247" data-toc="i7ehp9o_1247">优缺点</h3><div class="table-wrapper"><table class="wide" id="i7ehp9o_1248"><thead><tr class="ijRowHead" id="i7ehp9o_1249"><th id="i7ehp9o_1250"></th><th id="i7ehp9o_1251"><p>Docker容器</p></th><th id="i7ehp9o_1252"><p>虚拟机(VM)</p></th></tr></thead><tbody><tr id="i7ehp9o_1253"><td id="i7ehp9o_1254"><p>操作系统</p></td><td id="i7ehp9o_1255"><p>与宿主机共享OS</p></td><td id="i7ehp9o_1256"><p>宿主机OS上运行虚拟机OS</p></td></tr><tr id="i7ehp9o_1257"><td id="i7ehp9o_1258"><p>存储大小</p></td><td id="i7ehp9o_1259"><p>镜像小,便于存储与传输</p></td><td id="i7ehp9o_1260"><p>镜像庞大(vmdk,vdi等)</p></td></tr><tr id="i7ehp9o_1261"><td id="i7ehp9o_1262"><p>运行性能</p></td><td id="i7ehp9o_1263"><p>几乎无额外性能损失</p></td><td id="i7ehp9o_1264"><p>操作系统额外的CPU,内存消耗</p></td></tr><tr id="i7ehp9o_1265"><td id="i7ehp9o_1266"><p>移植性</p></td><td id="i7ehp9o_1267"><p>灵活,轻便,适应于Linux</p></td><td id="i7ehp9o_1268"><p>面向硬件运维者</p></td></tr><tr id="i7ehp9o_1269"><td id="i7ehp9o_1270"><p>部署速度</p></td><td id="i7ehp9o_1271"><p>快速,秒级</p></td><td id="i7ehp9o_1272"><p>较慢,10s以上</p></td></tr></tbody></table></div></section></section><section class="chapter"><h2 id="i7ehp9o_1273" data-toc="i7ehp9o_1273">常用命令</h2><section class="chapter"><h3 id="i7ehp9o_1274" data-toc="i7ehp9o_1274">帮助命令</h3><div class="code-block" data-lang="bash">
docker help
docker info
docker version
</div></section><section class="chapter"><h3 id="i7ehp9o_1276" data-toc="i7ehp9o_1276">镜像命令</h3><div class="code-block" data-lang="bash">
docker images
</div><ul class="list _bullet" id="i7ehp9o_1278"><li class="list__item" id="i7ehp9o_1279"><p>当前主机上的镜像</p></li><li class="list__item" id="i7ehp9o_1280"><p><code class="code" id="i7ehp9o_1281">-a</code>全部镜像(含中间镜像层)</p></li><li class="list__item" id="i7ehp9o_1282"><p><code class="code" id="i7ehp9o_1283">-q</code>imageId</p></li><li class="list__item" id="i7ehp9o_1284"><p><code class="code" id="i7ehp9o_1285">--digests</code> 详细信息</p></li><li class="list__item" id="i7ehp9o_1286"><p><code class="code" id="i7ehp9o_1287">--no-trunc</code> 显示完整的镜像信息</p></li></ul><div class="code-block" data-lang="bash">
docker search xxx
</div><ul class="list _bullet" id="i7ehp9o_1289"><li class="list__item" id="i7ehp9o_1290"><p>查询镜像</p></li><li class="list__item" id="i7ehp9o_1291"><p><code class="code" id="i7ehp9o_1292">-s [nums]</code>点赞数大于nums的</p></li></ul><div class="code-block" data-lang="bash">
docker pull xxx:[titile:默认不加]
docker rmi xxx
</div><ul class="list _bullet" id="i7ehp9o_1294"><li class="list__item" id="i7ehp9o_1295"><p><code class="code" id="i7ehp9o_1296">pull</code> 拉取镜像</p></li><li class="list__item" id="i7ehp9o_1297"><p><code class="code" id="i7ehp9o_1298">rmi</code></p><ul class="list _bullet" id="i7ehp9o_1299"><li class="list__item" id="i7ehp9o_1300"><p>删除镜像,要保证镜像以关闭</p></li><li class="list__item" id="i7ehp9o_1301"><p><code class="code" id="i7ehp9o_1302">-f</code>强制删除</p></li><li class="list__item" id="i7ehp9o_1303"><p>可多个删除</p></li><li class="list__item" id="i7ehp9o_1304"><p>删除全部 <code class="code" id="i7ehp9o_1305">docker rmi -f $(docker images -qa</code></p></li></ul></li></ul></section><section class="chapter"><h3 id="i7ehp9o_1306" data-toc="i7ehp9o_1306">容器命令</h3><p id="i7ehp9o_1307">以windows的vmare中的centos中的centos为例</p><section class="chapter"><h4 id="i7ehp9o_1308" data-toc="i7ehp9o_1308">新建并启动容器</h4><div class="code-block" data-lang="bash">
docker run[OPTIONS] IMAGE [COMMAND]{ARG...}
</div><ul class="list _bullet" id="i7ehp9o_1310"><li class="list__item" id="i7ehp9o_1311"><p><code class="code" id="i7ehp9o_1312">--name</code> 指定NAME</p></li><li class="list__item" id="i7ehp9o_1313"><p><code class="code" id="i7ehp9o_1314">-d</code> 后台运行容器,并返回容器ID,也即启动守护式容器</p></li><li class="list__item" id="i7ehp9o_1315"><p><code class="code" id="i7ehp9o_1316">-i</code>以交互模式运行容器,通常与-t同时使用</p></li><li class="list__item" id="i7ehp9o_1317"><p><code class="code" id="i7ehp9o_1318">-t</code>为容器重新分配一个伪输入终端</p></li></ul></section><section class="chapter"><h4 id="i7ehp9o_1319" data-toc="i7ehp9o_1319">列出当前所有正住运行的容器</h4><div class="code-block" data-lang="bash">
docker ps [OPTIONS]
</div><ul class="list _bullet" id="i7ehp9o_1321"><li class="list__item" id="i7ehp9o_1322"><p><code class="code" id="i7ehp9o_1323">-q</code> 静默模式,只显示容器编号</p></li><li class="list__item" id="i7ehp9o_1324"><p><code class="code" id="i7ehp9o_1325">-l</code> 显示最近创建过的容器</p></li><li class="list__item" id="i7ehp9o_1326"><p><code class="code" id="i7ehp9o_1327">-a</code> 列出当前所有正在运行的容器+历史运行过的</p></li><li class="list__item" id="i7ehp9o_1328"><p><code class="code" id="i7ehp9o_1329">-n</code> 显示最近n个创建的容器</p></li><li class="list__item" id="i7ehp9o_1330"><p><code class="code" id="i7ehp9o_1331">--no-trunc</code> 不截断输出</p></li></ul></section><section class="chapter"><h4 id="i7ehp9o_1332" data-toc="i7ehp9o_1332">操作容器</h4><ul class="list _bullet" id="i7ehp9o_1333"><li class="list__item" id="i7ehp9o_1334"><p id="i7ehp9o_1335">退出容器</p><ol class="list _decimal" id="i7ehp9o_1336" type="1"><li class="list__item" id="i7ehp9o_1337"><p><code class="code" id="i7ehp9o_1338">exit</code>关闭容器并退出</p></li><li class="list__item" id="i7ehp9o_1339"><p><code class="code" id="i7ehp9o_1340">Ctrl</code>+<code class="code" id="i7ehp9o_1341">p</code>+<code class="code" id="i7ehp9o_1342">q</code> 退出不关闭</p></li></ol></li><li class="list__item" id="i7ehp9o_1343"><p id="i7ehp9o_1344">启动容器</p><ul class="list _bullet" id="i7ehp9o_1345"><li class="list__item" id="i7ehp9o_1346"><p><code class="code" id="i7ehp9o_1347">docker start xxx</code> id或容器名</p></li></ul></li><li class="list__item" id="i7ehp9o_1348"><p id="i7ehp9o_1349">重启容器</p><ul class="list _bullet" id="i7ehp9o_1350"><li class="list__item" id="i7ehp9o_1351"><p><code class="code" id="i7ehp9o_1352">docker restart xxx</code>id或容器名</p></li></ul></li><li class="list__item" id="i7ehp9o_1353"><p id="i7ehp9o_1354">停止</p><ul class="list _bullet" id="i7ehp9o_1355"><li class="list__item" id="i7ehp9o_1356"><p><code class="code" id="i7ehp9o_1357">docker stop xxx</code> 停止容器</p></li><li class="list__item" id="i7ehp9o_1358"><p><code class="code" id="i7ehp9o_1359">docker kill xxx</code> 强制停止容器</p></li></ul></li><li class="list__item" id="i7ehp9o_1360"><p id="i7ehp9o_1361">删除容器 <code class="code" id="i7ehp9o_1362">docker rm xxx</code>没有i::</p><ul class="list _bullet" id="i7ehp9o_1363"><li class="list__item" id="i7ehp9o_1364"><p><code class="code" id="i7ehp9o_1365">-f</code> 强制删除</p></li><li class="list__item" id="i7ehp9o_1366"><p>删除多个容器 </p><ul class="list _bullet" id="i7ehp9o_1367"><li class="list__item" id="i7ehp9o_1368"><p><code class="code" id="i7ehp9o_1369">docker rm -f $(docker ps -a -q)</code></p></li><li class="list__item" id="i7ehp9o_1370"><p><code class="code" id="i7ehp9o_1371">docker ps -a -q|xargs docker rm</code></p></li></ul></li></ul></li></ul></section></section><section class="chapter"><h3 id="i7ehp9o_1372" data-toc="i7ehp9o_1372">重要命令</h3><ol class="list _decimal" id="i7ehp9o_1373" type="1"><li class="list__item" id="i7ehp9o_1374"><p id="i7ehp9o_1375">启动</p><ul class="list _bullet" id="i7ehp9o_1376"><li class="list__item" id="i7ehp9o_1377"><p><code class="code" id="i7ehp9o_1378">docker run -d centos</code> 后台启动centos,但会被瞬间退出 </p><ul class="list _bullet" id="i7ehp9o_1379"><li class="list__item" id="i7ehp9o_1380"><p>docker 容器后台运行,必须要有前台进程</p></li><li class="list__item" id="i7ehp9o_1381"><p>容器运行的命令如果不是那些一直挂起的命令(top,tail),会自动退出</p></li></ul></li></ul></li><li class="list__item" id="i7ehp9o_1382"><p id="i7ehp9o_1383">查看容器日志</p><ul class="list _bullet" id="i7ehp9o_1384"><li class="list__item" id="i7ehp9o_1385"><p><code class="code" id="i7ehp9o_1386">docker logs -f -t --tail n xxx</code></p><ul class="list _bullet" id="i7ehp9o_1387"><li class="list__item" id="i7ehp9o_1388"><p><code class="code" id="i7ehp9o_1389">-t</code>是加入时间戳</p></li><li class="list__item" id="i7ehp9o_1390"><p><code class="code" id="i7ehp9o_1391">-f</code> 跟随最新的日志打印</p></li><li class="list__item" id="i7ehp9o_1392"><p><code class="code" id="i7ehp9o_1393">--tail</code> 数字显示最后多少条</p></li></ul></li></ul></li><li class="list__item" id="i7ehp9o_1394"><p id="i7ehp9o_1395">查看容器内运行的进程</p><ul class="list _bullet" id="i7ehp9o_1396"><li class="list__item" id="i7ehp9o_1397"><p><code class="code" id="i7ehp9o_1398">docker top xxx</code>相当于linux的top</p></li></ul></li><li class="list__item" id="i7ehp9o_1399"><p id="i7ehp9o_1400">查看容器内部细节</p><ul class="list _bullet" id="i7ehp9o_1401"><li class="list__item" id="i7ehp9o_1402"><p><code class="code" id="i7ehp9o_1403">docker inspect 容器ID</code></p></li></ul></li><li class="list__item" id="i7ehp9o_1404"><p id="i7ehp9o_1405">进入正在运行的容器并以命令行交互</p><ul class="list _bullet" id="i7ehp9o_1406"><li class="list__item" id="i7ehp9o_1407"><p><code class="code" id="i7ehp9o_1408">docker exec -it 容器ID bashShell</code></p><ul class="list _bullet" id="i7ehp9o_1409"><li class="list__item" id="i7ehp9o_1410"><p>是在容器中打开新的终端,并且可以启动新的进程</p></li></ul></li><li class="list__item" id="i7ehp9o_1411"><p>重新进入<code class="code" id="i7ehp9o_1412">docker attach 容器ID</code></p><ul class="list _bullet" id="i7ehp9o_1413"><li class="list__item" id="i7ehp9o_1414"><p>直接进入容器启动命令的终端,不会启动新的进程</p></li></ul></li></ul></li><li class="list__item" id="i7ehp9o_1415"><p id="i7ehp9o_1416">从容器内拷贝文件到宿主机</p><ul class="list _bullet" id="i7ehp9o_1417"><li class="list__item" id="i7ehp9o_1418"><p><code class="code" id="i7ehp9o_1419">docker cp 容器ID:路径 宿主机路径:</code></p></li></ul></li></ol></section></section><section class="chapter"><h2 id="i7ehp9o_1420" data-toc="i7ehp9o_1420">镜像原理</h2><ul class="list _bullet" id="i7ehp9o_1421"><li class="list__item" id="i7ehp9o_1422"><p id="i7ehp9o_1423">是什么: 1.UnionFS(联合文件系统) bootfs rootfs</p><ol class="list _decimal" id="i7ehp9o_1424" type="1" start="2"><li class="list__item" id="i7ehp9o_1425"><p>Docker镜像加载原理</p></li><li class="list__item" id="i7ehp9o_1426"><p>分层的镜像</p></li></ol></li><li class="list__item" id="i7ehp9o_1427"><p id="i7ehp9o_1428">特点</p><ol class="list _decimal" id="i7ehp9o_1429" type="1"><li class="list__item" id="i7ehp9o_1430"><p>Docker镜像都是只读的</p></li><li class="list__item" id="i7ehp9o_1431"><p>当容器启动时,一个新的可写层被加载到镜像的顶部.这一层通常被称作&quot;容器层&quot;,&quot;容器层&quot;之下的都叫镜像层</p></li></ol></li><li class="list__item" id="i7ehp9o_1432"><p id="i7ehp9o_1433">tomcat</p><ul class="list _bullet" id="i7ehp9o_1434"><li class="list__item" id="i7ehp9o_1435"><p><code class="code" id="i7ehp9o_1436">docker run -it -p 8888:8080 tomcat</code> 端口映射</p></li></ul></li><li class="list__item" id="i7ehp9o_1437"><p id="i7ehp9o_1438">提交commit</p><ul class="list _bullet" id="i7ehp9o_1439"><li class="list__item" id="i7ehp9o_1440"><p><code class="code" id="i7ehp9o_1441">docker commit -m=&quot;提交的信息&quot; -a=&quot;作者&quot; 容器ID 要创建的镜像名:[标签名]</code></p></li></ul></li></ul></section><section class="chapter"><h2 id="docker" data-toc="docker">Docker容器数据卷</h2><ul class="list _bullet" id="i7ehp9o_1442"><li class="list__item" id="i7ehp9o_1443"><p>是什么 </p><ul class="list _bullet" id="i7ehp9o_1444"><li class="list__item" id="i7ehp9o_1445"><p>保存数据 类似docker cp</p></li></ul></li><li class="list__item" id="i7ehp9o_1446"><p>特点 </p><ol class="list _decimal" id="i7ehp9o_1447" type="1"><li class="list__item" id="i7ehp9o_1448"><p>数据卷可在容器之间共享或重用数据</p></li><li class="list__item" id="i7ehp9o_1449"><p>卷中的更改可以直接生效</p></li><li class="list__item" id="i7ehp9o_1450"><p>数据卷中的更改不会包含在镜像的更新中</p></li><li class="list__item" id="i7ehp9o_1451"><p>数据卷的生命周期一直持续到没有容器继续使用它为止</p></li></ol></li><li class="list__item" id="i7ehp9o_1452"><p>数据卷 容器内添加 </p><ul class="list _bullet" id="i7ehp9o_1453"><li class="list__item" id="i7ehp9o_1454"><p>直接命令添加 </p><ul class="list _bullet" id="i7ehp9o_1455"><li class="list__item" id="i7ehp9o_1456"><p><code class="code" id="i7ehp9o_1457">docker run -it -v /宿主机绝对路径目录:/容器目录 镜像名</code> 如果目录不存在,会创建目录</p></li><li class="list__item" id="i7ehp9o_1458"><p><code class="code" id="i7ehp9o_1459">docker inspect</code> 查看详细信息,看是否挂载成功</p></li><li class="list__item" id="i7ehp9o_1460"><p><code class="code" id="i7ehp9o_1461">docker run -it -v /宿主机绝对路径目录:/容器内目录:ro 镜像名</code> 只读</p></li><li class="list__item" id="i7ehp9o_1462"><p><code class="code" id="i7ehp9o_1463">--privileged=true</code> 若没有权限加此参数</p></li></ul></li><li class="list__item" id="i7ehp9o_1464"><p>dockerFile添加 备注:</p></li></ul></li></ul></section><section class="chapter"><h2 id="notes-tool-dockerfile" data-toc="notes-tool-dockerfile">notes.Tool.DockerFile</h2><section class="chapter"><h3 id="i7ehp9o_1465" data-toc="i7ehp9o_1465">直接命令添加</h3></section><section class="chapter"><h3 id="dockerfile" data-toc="dockerfile">DockerFile添加</h3><ol class="list _decimal" id="i7ehp9o_1466" type="1"><li class="list__item" id="i7ehp9o_1467"><p>根目录下新建mydocker并进入</p></li><li class="list__item" id="i7ehp9o_1468"><p>可在Dockerfile中使用VOLUME指令来给镜像添加一个或多个数据卷</p></li><li class="list__item" id="i7ehp9o_1469"><p>File构建</p></li><li class="list__item" id="i7ehp9o_1470"><p>build后生成镜像</p></li><li class="list__item" id="i7ehp9o_1471"><p>run容器</p></li></ol></section><section class="chapter"><h3 id="i7ehp9o_1472" data-toc="i7ehp9o_1472">数据卷容器</h3><p id="i7ehp9o_1473">命名的容器挂载数据卷,其他容器通过挂载这个(父容器)实现数据共享,挂在数据卷的容器,称之为数据卷容器</p><ul class="list _bullet" id="i7ehp9o_1474"><li class="list__item" id="i7ehp9o_1475"><p>容器间传递共享(--volumes-from) </p><ul class="list _bullet" id="i7ehp9o_1476"><li class="list__item" id="i7ehp9o_1477"><p>先启动一个父容器dk01</p></li><li class="list__item" id="i7ehp9o_1478"><p>dk02/dk03 (集成)共享dk01 dk01</p></li></ul></li></ul><div class="code-block" data-lang="json">
&quot;Mounts&quot;: [
           {
               &quot;Type&quot;: &quot;volume&quot;,
               &quot;Name&quot;: &quot;bcae3861c5c98efb330484995446b084bab5e63ce69cb8c0d3d0a4d650caa7d4&quot;,
               &quot;Source&quot;: &quot;/var/lib/docker/volumes/bcae3861c5c98efb330484995446b084bab5e63ce69cb8c0d3d0a4d650caa7d4/_data&quot;,
               &quot;Destination&quot;: &quot;/dataVolumeContainer2&quot;,
               &quot;Driver&quot;: &quot;local&quot;,
               &quot;Mode&quot;: &quot;&quot;,
               &quot;RW&quot;: true,
               &quot;Propagation&quot;: &quot;&quot;
           },
           {
               &quot;Type&quot;: &quot;volume&quot;,
               &quot;Name&quot;: &quot;e072f0984f04bc3342bcf500549f2533c5b8b6a90f41fd60bd049048b46e84cb&quot;,
               &quot;Source&quot;: &quot;/var/lib/docker/volumes/e072f0984f04bc3342bcf500549f2533c5b8b6a90f41fd60bd049048b46e84cb/_data&quot;,
               &quot;Destination&quot;: &quot;/dataVolumeContainer1&quot;,
               &quot;Driver&quot;: &quot;local&quot;,
               &quot;Mode&quot;: &quot;&quot;,
               &quot;RW&quot;: true,
               &quot;Propagation&quot;: &quot;&quot;
           }
       ],

</div><p id="i7ehp9o_1480">dk02</p><div class="code-block" data-lang="json">
 &quot;Mounts&quot;: [
            {
                &quot;Type&quot;: &quot;volume&quot;,
                &quot;Name&quot;: &quot;e072f0984f04bc3342bcf500549f2533c5b8b6a90f41fd60bd049048b46e84cb&quot;,
                &quot;Source&quot;: &quot;/var/lib/docker/volumes/e072f0984f04bc3342bcf500549f2533c5b8b6a90f41fd60bd049048b46e84cb/_data&quot;,
                &quot;Destination&quot;: &quot;/dataVolumeContainer1&quot;,
                &quot;Driver&quot;: &quot;local&quot;,
                &quot;Mode&quot;: &quot;&quot;,
                &quot;RW&quot;: true,
                &quot;Propagation&quot;: &quot;&quot;
            },
            {
                &quot;Type&quot;: &quot;volume&quot;,
                &quot;Name&quot;: &quot;bcae3861c5c98efb330484995446b084bab5e63ce69cb8c0d3d0a4d650caa7d4&quot;,
                &quot;Source&quot;: &quot;/var/lib/docker/volumes/bcae3861c5c98efb330484995446b084bab5e63ce69cb8c0d3d0a4d650caa7d4/_data&quot;,
                &quot;Destination&quot;: &quot;/dataVolumeContainer2&quot;,
                &quot;Driver&quot;: &quot;local&quot;,
                &quot;Mode&quot;: &quot;&quot;,
                &quot;RW&quot;: true,
                &quot;Propagation&quot;: &quot;&quot;
            }
        ],

</div><p id="i7ehp9o_1482">挂载对应一致,实现共享数据</p></section><section class="chapter"><h3 id="notes-tool-dockerfile" data-toc="notes-tool-dockerfile">notes.Tool.DockerFile 规范</h3><ol class="list _decimal" id="i7ehp9o_1483" type="1"><li class="list__item" id="i7ehp9o_1484"><p>每条保留字指令都必须为大写字母且后面至少跟随一个参数</p></li><li class="list__item" id="i7ehp9o_1485"><p>指令按照从上到下,顺序执行</p></li><li class="list__item" id="i7ehp9o_1486"><p><code class="code" id="i7ehp9o_1487">#</code>表示注释</p></li><li class="list__item" id="i7ehp9o_1488"><p>每条指令都会创建一个新的镜像层,并对镜像进行提交</p></li></ol><ul class="list _bullet" id="i7ehp9o_1489"><li class="list__item" id="i7ehp9o_1490"><p>总结: </p><ol class="list _decimal" id="i7ehp9o_1491" type="1"><li class="list__item" id="i7ehp9o_1492"><p>Dockerfile,需要定一个Dockerfile,Dockerfile定义了进程需要的一切东西,Dockerfile涉及的内容包括执行代码或是文件, 环境,变量,依赖包,运行时环境,动态链接库,操作系统的发行版,服务进程和内核(当应用进程需要和系统服务和内核进程打交道, 这时需思考如何设计namespace的控制权限)等等</p></li><li class="list__item" id="i7ehp9o_1493"><p>Docker 镜像,在用Dockerfile定义一个文件之后, <code class="code" id="i7ehp9o_1494">docker build</code>会产生一个Docker镜像,当运行Docker镜像时,会真正开始提供服务</p></li><li class="list__item" id="i7ehp9o_1495"><p>Docker容器,容器是直接提供服务的</p></li><li class="list__item" id="i7ehp9o_1496"><p>例: <code class="code" id="i7ehp9o_1497">docker build -f ./DockerFileTest2 -t test/centos:1.4 .</code></p></li></ol></li></ul></section><section class="chapter"><h3 id="dockerfile" data-toc="dockerfile">DockerFile体系结构(保留字指令)</h3><ul class="list _bullet" id="i7ehp9o_1498"><li class="list__item" id="i7ehp9o_1499"><p><code class="code" id="i7ehp9o_1500">From</code> 基础镜像,当前新镜像是基于哪个镜像的</p></li><li class="list__item" id="i7ehp9o_1501"><p><code class="code" id="i7ehp9o_1502">MAINTAINER</code> 镜像维护者的姓名和邮箱地址</p></li><li class="list__item" id="i7ehp9o_1503"><p><code class="code" id="i7ehp9o_1504">RUN</code> 容器构建时需要运行的命令</p></li><li class="list__item" id="i7ehp9o_1505"><p><code class="code" id="i7ehp9o_1506">EXPOSE</code> 当前容器对外暴露出的端口</p></li><li class="list__item" id="i7ehp9o_1507"><p><code class="code" id="i7ehp9o_1508">WORKDIR</code> 指定在创建容器后,终端默认登录的进来工作目录,一个落脚点</p></li><li class="list__item" id="i7ehp9o_1509"><p><code class="code" id="i7ehp9o_1510">ENV</code>用来在构建镜像过程中设置环境变量</p></li><li class="list__item" id="i7ehp9o_1511"><p><code class="code" id="i7ehp9o_1512">ADD</code>将宿主机目录下的文件拷贝进镜像且ADD命令会自动处理URL和解压tar压缩包</p></li><li class="list__item" id="i7ehp9o_1513"><p><code class="code" id="i7ehp9o_1514">COPY</code></p><ul class="list _bullet" id="i7ehp9o_1515"><li class="list__item" id="i7ehp9o_1516"><p>类似<code class="code" id="i7ehp9o_1517">ADD</code> ,拷贝文件和目录到镜像中</p></li><li class="list__item" id="i7ehp9o_1518"><p>将从构建上下文目录中&lt;路径源&gt;的文件/目录复制到新的一层的镜像内&lt;目标路径&gt;位置</p></li></ul></li><li class="list__item" id="i7ehp9o_1519"><p><code class="code" id="i7ehp9o_1520">VOLUME</code> 容器数据卷,用于数据保存和持久化工作</p></li><li class="list__item" id="i7ehp9o_1521"><p><code class="code" id="i7ehp9o_1522">CMD</code></p><ul class="list _bullet" id="i7ehp9o_1523"><li class="list__item" id="i7ehp9o_1524"><p>指定一个容器启动时要运行的命令</p></li><li class="list__item" id="i7ehp9o_1525"><p>Dockerfile中可以有多个CMD命令,但只有最后一个生效,CMD会被<code class="code" id="i7ehp9o_1526">docker run</code>之后的参数替换</p></li></ul></li><li class="list__item" id="i7ehp9o_1527"><p><code class="code" id="i7ehp9o_1528">ENTRYPOINT</code></p><ul class="list _bullet" id="i7ehp9o_1529"><li class="list__item" id="i7ehp9o_1530"><p>指定一个容器启动时要运行的命令</p></li><li class="list__item" id="i7ehp9o_1531"><p><code class="code" id="i7ehp9o_1532">ENTRYPOINT</code> 的目的和<code class="code" id="i7ehp9o_1533">CMD</code>一样,都是在指定容器启动程序及参数</p></li></ul></li><li class="list__item" id="i7ehp9o_1534"><p><code class="code" id="i7ehp9o_1535">ONBUILD</code> 当构建一个被继承的Dockerfile时运行命令,父镜像在被子继承后父镜像<code class="code" id="i7ehp9o_1536">onbuild</code>被触发</p></li></ul><section class="chapter"><h4 id="i7ehp9o_1537" data-toc="i7ehp9o_1537">遇到的问题</h4><ul class="list _bullet" id="i7ehp9o_1538"><li class="list__item" id="i7ehp9o_1539"><p>WARNING: IPv4 forwarding is disabled. Networking will not work. 导致<code class="code" id="i7ehp9o_1540">RUN yum -y install xxx</code> 不可用 </p><ul class="list _bullet" id="i7ehp9o_1541"><li class="list__item" id="i7ehp9o_1542"><p>原因,docker 容器ip地址未分配</p></li><li class="list__item" id="i7ehp9o_1543"><p>解决措施: 复用宿主机ip </p><ul class="list _bullet" id="i7ehp9o_1544"><li class="list__item" id="i7ehp9o_1545"><p>写入宿主机 </p><ul class="list _bullet" id="i7ehp9o_1546"><li class="list__item" id="i7ehp9o_1547"><p><code class="code" id="i7ehp9o_1548">echo &quot;net.ipv4.ip_forward=1&quot; &gt;&gt;/usr/lib/sysctl.d/00-system.conf</code></p></li></ul></li><li class="list__item" id="i7ehp9o_1549"><p>重启宿主机network和docker </p><ul class="list _bullet" id="i7ehp9o_1550"><li class="list__item" id="i7ehp9o_1551"><p><code class="code" id="i7ehp9o_1552">systemctl restart network</code></p></li><li class="list__item" id="i7ehp9o_1553"><p><code class="code" id="i7ehp9o_1554">systemctl restart docker</code></p></li></ul></li></ul></li></ul></li></ul></section></section><section class="chapter"><h3 id="push" data-toc="push">push</h3><div class="code-block" data-lang="bash">
$ sudo docker login --username=chinaanhlaidh registry.cn-hangzhou.aliyuncs.com
$ sudo docker tag [ImageId] registry.cn-hangzhou.aliyuncs.com/anhlaidh/mysentos:[镜像版本号]
$ sudo docker push registry.cn-hangzhou.aliyuncs.com/anhlaidh/mysentos:[镜像版本号]
</div><div class="code-block" data-lang="bash">
$ sudo docker tag e575ef00df05 registry.cn-hangzhou.aliyuncs.com/anhlaidh/mysentos:1.0.1
</div></section></section><div class="last-modified">Last modified: 30 四月 2024</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="git.html" class="navigation-links__next">Git</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b259/app.js"></script></body></html>